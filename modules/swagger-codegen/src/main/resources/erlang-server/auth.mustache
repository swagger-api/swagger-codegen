-module({{packageName}}_auth).

-export([authorize_api_key/5]).

authorize_api_key(From, KeyParam, OperationID, Req0, LogicHandler) ->
  {ApiKey, Req} = get_api_key(From, KeyParam, Req0),
  case ApiKey of
    undefined ->
        AuthHeader = <<"">>,
        {false, AuthHeader, Req};
    _ ->
      case LogicHandler:authorize_api_key(ApiKey, OperationID) of
        {true, Context}  ->
          {true, Context, Req};
        false ->
          AuthHeader = <<"">>,
          {false, AuthHeader, Req}
      end
  end.

get_api_key(header, KeyParam, Req0) ->
    {Headers, Req} = cowboy_req:headers(Req0),
    {swagger_utils:get_opt({{packageName}}_utils:string_to_header(KeyParam), Headers), Req};

get_api_key(qs_val, KeyParam, Req0) ->
    {QS, Req} = cowboy_req:qs_vals(Req0),
    {swagger_utils:get_opt(KeyParam, QS), Req}.



